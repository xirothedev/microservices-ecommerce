model Warehouse {
  id         String   @id @default(cuid())
  name       String
  code       String   @unique
  address    String
  city       String
  state      String
  postalCode String
  country    String   @default("VN")
  phone      String?
  email      String?
  managerId  String? // ID từ Auth Service
  isActive   Boolean  @default(true)
  capacity   Decimal? @db.Decimal(10, 2) // Total capacity in cubic meters
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  zones           WarehouseZone[]
  movements       StockMovement[]
  InventoryItem   InventoryItem[]
  transfersFrom   StockTransfer[]   @relation("TransferFrom")
  transfersTo     StockTransfer[]   @relation("TransferTo")
  StockAdjustment StockAdjustment[]

  @@map("warehouses")
  @@schema("inventory")
}

model WarehouseZone {
  id          String   @id @default(cuid())
  warehouseId String
  name        String
  code        String
  type        ZoneType
  temperature Decimal? @db.Decimal(5, 2) // Celsius
  humidity    Decimal? @db.Decimal(5, 2) // Percentage
  capacity    Decimal? @db.Decimal(10, 2)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  warehouse Warehouse       @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  items     InventoryItem[]

  @@map("warehouse_zones")
  @@schema("inventory")
}

model InventoryItem {
  id           String   @id @default(cuid())
  productId    String // ID từ Products Service
  variantId    String? // ID từ Products Service
  warehouseId  String
  zoneId       String?
  sku          String
  quantity     Int      @default(0)
  reserved     Int      @default(0)
  available    Int      @default(0) // quantity - reserved
  reorderLevel Int      @default(0)
  maxQuantity  Int?
  cost         Decimal? @db.Decimal(10, 2)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  warehouse Warehouse       @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  zone      WarehouseZone?  @relation(fields: [zoneId], references: [id])
  movements StockMovement[]

  @@unique([productId, variantId, warehouseId, zoneId])
  @@unique([productId, variantId, warehouseId])
  @@map("inventory_items")
  @@schema("inventory")
}

model StockMovement {
  id             String       @id @default(cuid())
  productId      String // ID từ Products Service
  variantId      String? // ID từ Products Service
  warehouseId    String
  type           MovementType
  reason         String?
  quantity       Int
  quantityBefore Int
  quantityAfter  Int
  cost           Decimal?     @db.Decimal(10, 2)
  referenceId    String? // ID của order, transfer, etc.
  referenceType  String? // order, transfer, adjustment, etc.
  notes          String?
  createdAt      DateTime     @default(now())

  // Relations
  warehouse Warehouse      @relation(fields: [warehouseId], references: [id])
  item      InventoryItem? @relation(fields: [productId, variantId, warehouseId], references: [productId, variantId, warehouseId])

  @@map("stock_movements")
  @@schema("inventory")
}

model StockTransfer {
  id              String         @id @default(cuid())
  transferNumber  String         @unique
  fromWarehouseId String
  toWarehouseId   String
  status          TransferStatus @default(PENDING)
  notes           String?
  requestedBy     String // ID từ Auth Service
  approvedBy      String? // ID từ Auth Service
  shippedAt       DateTime?
  receivedAt      DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  // Relations
  fromWarehouse Warehouse           @relation("TransferFrom", fields: [fromWarehouseId], references: [id])
  toWarehouse   Warehouse           @relation("TransferTo", fields: [toWarehouseId], references: [id])
  items         StockTransferItem[]

  @@map("stock_transfers")
  @@schema("inventory")
}

model StockTransferItem {
  id               String  @id @default(cuid())
  transferId       String
  productId        String // ID từ Products Service
  variantId        String? // ID từ Products Service
  quantity         Int
  quantitySent     Int     @default(0)
  quantityReceived Int     @default(0)
  notes            String?

  // Relations
  transfer StockTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@map("stock_transfer_items")
  @@schema("inventory")
}

model StockAdjustment {
  id          String         @id @default(cuid())
  productId   String // ID từ Products Service
  variantId   String? // ID từ Products Service
  warehouseId String
  type        AdjustmentType
  reason      String
  quantity    Int
  cost        Decimal?       @db.Decimal(10, 2)
  notes       String?
  createdBy   String // ID từ Auth Service
  createdAt   DateTime       @default(now())

  // Relations
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])

  @@map("stock_adjustments")
  @@schema("inventory")
}

enum ZoneType {
  DRY_STORAGE
  COLD_STORAGE
  FROZEN_STORAGE
  CONTROLLED_ATMOSPHERE
  QUARANTINE
  PACKAGING
  SHIPPING

  @@schema("inventory")
}

enum MovementType {
  IN
  OUT
  TRANSFER_IN
  TRANSFER_OUT
  ADJUSTMENT
  RETURN
  DAMAGE
  EXPIRED

  @@schema("inventory")
}

enum TransferStatus {
  PENDING
  APPROVED
  SHIPPED
  RECEIVED
  CANCELLED

  @@schema("inventory")
}

enum AdjustmentType {
  PHYSICAL_COUNT
  DAMAGE
  EXPIRED
  THEFT
  SYSTEM_ERROR
  OTHER

  @@schema("inventory")
}
