model Ticket {
  id               String         @id @default(uuid()) @db.Uuid
  numericalOrder   Int            @default(autoincrement()) @map("numerical_order") @db.Integer
  createAt         DateTime       @default(now()) @map("create_at") @db.Timestamptz
  updateAt         DateTime       @updatedAt @map("update_at") @db.Timestamptz
  title            String         @db.VarChar(255)
  description      String         @db.Text
  status           TicketStatus   @default(OPEN)
  category         TicketCategory
  priority         TicketPriority
  referenceContext String?        @map("reference_context") @db.Text
  attachments      String[]       @db.VarChar(500)

  authorId   String          @map("author_id") @db.Uuid
  author     User            @relation(name: "TicketAuthor", fields: [authorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  assignedId String?         @map("assigned_id") @db.Uuid
  assigned   User?           @relation(name: "TicketAssigned", fields: [assignedId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  messages   TicketMessage[]
}

model TicketMessage {
  id        String   @id @default(uuid()) @db.Uuid
  content   String   @db.Text
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  ticketId String @map("ticket_id") @db.Uuid
  ticket   Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  senderId String @map("sender_id") @db.Uuid
  sender   User   @relation("TicketMessageSender", fields: [senderId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  attachments String[]
}

enum TicketStatus {
  RESOLVED
  IN_PROGRESS
  WAITING
  OPEN
  CLOSED
}

enum TicketCategory {
  TECHNICAL_SUPPORT
  BILLING_PAYMENT
  ACCOUNT_ISSUE
  SERVICE_REQUEST
  REFUND_REQUEST
  GENERAL_INQUIRY
}

enum TicketPriority {
  URGENT
  HIGH
  MEDIUM
  LOW
}
