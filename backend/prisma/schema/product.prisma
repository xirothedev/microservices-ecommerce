model Product {
  id            String        @id @default(cuid()) @db.VarChar(25)
  createAt      DateTime      @default(now()) @map("create_at") @db.Timestamptz
  updateAt      DateTime      @updatedAt @map("update_at") @db.Timestamptz
  sku           String?       @unique @db.VarChar(50)
  isActive      Boolean       @default(true) @map("is_active")
  slug          String        @unique @db.VarChar(255)
  name          String        @db.VarChar(255)
  description   String        @db.Text
  stock         Int           @db.SmallInt
  sold          Int           @default(0) @db.SmallInt
  flags         ProductFlag[]
  originalPrice Int           @map("original_price") @db.Integer
  discountPrice Int           @map("discount_price") @db.Integer
  averageRating Decimal?      @default(0.0) @map("average_rating") @db.Decimal(2, 1)
  tags          String[]      @db.VarChar(100)
  medias        String[]      @db.VarChar(500)

  categoryId   String        @map("category_id") @db.Uuid
  category     Category      @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  sellerId     String        @db.Uuid
  seller       User          @relation(fields: [sellerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  cartItem     CartItem[]
  productItems ProductItem[]
  orderItem    OrderItem[]
  reviews      Review[]
}

model ProductItem {
  id        String  @id @default(cuid()) @db.VarChar(25)
  productId String  @map("product_id") @db.VarChar(25)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  data   String    @db.Text
  isSold Boolean   @default(false) @map("is_sold")
  soldAt DateTime? @map("sold_at") @db.Timestamptz

  order OrderItem?
}

model Category {
  id       String    @id @default(uuid()) @db.Uuid
  name     String    @db.VarChar(100)
  slug     String    @db.VarChar(100)
  products Product[]
}

model Review {
  id        String   @id @default(cuid()) @db.VarChar(25)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz
  rating    Decimal  @db.Decimal(2, 1)
  comment   String   @db.Text

  productId String  @map("product_id") @db.VarChar(25)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  userId String @map("user_id") @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([productId, userId], name: "productUserId", map: "product_user_id")
}

enum ProductFlag {
  BEST_CHOICE
  BEST_SELLER
  BEST_CHEAP
  POPULAR
}
